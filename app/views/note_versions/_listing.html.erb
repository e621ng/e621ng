<table class="striped autofit">
  <thead>
    <tr>
      <th></th>
      <th width="5%">Post</th>
      <th width="5%">Note</th>
      <th>Body</th>
      <th width="5%">Position</th>
      <% if CurrentUser.is_admin? %>
        <th width="10%">IP Address</th>
      <% end %>
      <th width="10%">Edited By</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% @note_versions.each do |note_version| %>
      <tr id="note-version-<%= note_version.id%>" class="note-version" data-note-version-id="<%= note_version.id %>">
        <td>
          <% if CurrentUser.is_privileged? %>
            <input type="checkbox" class="note-version-select">
          <% end %>
        </td>
        <td>
          <%= link_to note_version.post_id, post_path(note_version.post_id) %>
          <%= link_to "»", note_versions_path(search: { post_id: note_version.post_id }) %>
        </td>
        <td>
          <%= link_to "#{note_version.note_id}.#{note_version.version}", post_path(note_version.post_id, anchor: "note-#{note_version.note_id}") %>
          <%= link_to "»", note_versions_path(search: { note_id: note_version.note_id }) %>
        </td>
        <td class="col-expand">
          <%= h(note_version.body) %>
          <% unless note_version.is_active? %>
            <span class="inactive">(deleted)</span>
          <% end %>
          <%= note_version_body_diff_info(note_version) %>
        </td>
        <td>
          <%= note_version_position_diff(note_version) %>
        </td>
        <% if CurrentUser.is_admin? %>
          <td>
            <%= link_to_ip note_version.updater_ip_addr %>
          </td>
        <% end %>
        <td>
          <%= link_to_user note_version.updater %>
          <p><%= compact_time note_version.updated_at %></p>
        </td>
        <td>
          <% if CurrentUser.is_member? %>
            <%= link_to "Undo", undo_note_version_path(note_version), method: :put %>
            <% if params.dig(:search, :post_id).present? || params.dig(:search, :note_id).present? %>
              | <%= link_to "Revert to", revert_note_path(note_version.note_id, version_id: note_version.id, format: :json), class: "revert-item-link", data: { noun: "post" } %>
            <% end %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
