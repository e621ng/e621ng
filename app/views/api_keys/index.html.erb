<h1>API Keys</h1>

<%= render "secondary_links" %>

<div class="instructions">
  <p>An API key is used to give programs access to your <%= Danbooru.config.app_name %> account.</p>

  <p>If you're a developer, you can use an API key to access the
    <%= link_to("#{Danbooru.config.app_name} API", help_page_path(id: "api")) %>. If you're not a
    developer, and you're not using any third-party apps, then you probably don't need an API key.</p>

  <p><strong>Your API key is like your password</strong>. Anyone who has it has full access to
    your account. Don't give your API key to apps or people you don't trust, and don't post your
    API key in public locations.</p>

  <p>Example usage:
    <code>
      <% if @api_keys.present? %>
        <%= posts_path(format: "json", login: CurrentUser.user.name, api_key: @api_keys.first.key) %>
      <% else %>
        <%= posts_path(format: "json", login: CurrentUser.user.name, api_key: "your_api_key_goes_here") %>
      <% end %>
    </code>
  </p>
</div>

<%= link_to("Create API key", new_api_key_path, class: "button create-api-key") %>

<% if @api_keys.any? %>
  <table class="striped" width="100%">
    <thead>
      <tr>
        <th>Name</th>
        <th>Key</th>
        <th>Uses</th>
        <th>Last Used</th>
        <th>Expires</th>
        <th>Created</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% @api_keys.each do |api_key| %>
        <tr id="api-key-<%= api_key.id %>">
          <td><%= api_key.name %></td>
          <td><code><%= api_key.key %></code></td>
          <td><%= number_with_delimiter(api_key.uses) %></td>
          <td>
            <% if api_key.last_used_at %>
              <%= time_ago_in_words(api_key.last_used_at) %> ago
              <% if api_key.last_ip_address %>
                <br>by <%= api_key.last_ip_address %>
              <% end %>
            <% else %>
              Never
            <% end %>
          </td>
          <td>
            <% if api_key.expires_at %>
              <%= time_ago_in_words(api_key.expires_at) %>
              <% if api_key.expired? %>
                <span class="error">(Expired)</span>
              <% end %>
            <% else %>
              Never
            <% end %>
          </td>
          <td><%= time_ago_in_words(api_key.created_at) %> ago</td>
          <td>
            <%= link_to("Delete", api_key, method: :delete, 
                confirm: "Are you sure you want to delete this API key?") %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p>You don't have any API keys yet.</p>
<% end %>

<% content_for(:page_title) do %>
  API Keys
<% end %>
