<% status_class = "" %>
<% if post_replacement.is_pending? then status_class += "replacement-pending-row" end %>
<% if post_replacement.md5 == post_replacement.post.md5 then status_class += " replacement-current-row" end %>
<tr id="replacement-<%= post_replacement.id %>" class="<%= status_class %>">  <td><%= PostPresenter.preview(post_replacement.post, show_deleted: true) %></td>
  <td><%= replacement_thumbnail(post_replacement) %></td>
  <td>
    <dt>Version</dt>
    <dd><%= post_replacement.post_id %>:<%= post_replacement.sequence_number %></dd>
    <dt>Status</dt>
    <dd class="replacement-compact-row">
      <% if post_replacement.status == "pending" %>
        <% highlighted_tags = post_replacement.post.tag_array & PostReplacement::HIGHLIGHTED_TAGS %>
        <% icon_names = {
          "avoid_posting" => "octagon_x",
          "conditional_dnp" => "octagon_alert",
          "better_version_at_source" => "diamond_plus"
        } %>
        <% highlighted_tags.each do |tag| %>
          <%= svg_icon(icon_names[tag].to_sym, title: tag, height: 15, width: 15) if icon_names[tag].present? %>
        <% end %>
      <% end %>
      <%= post_replacement.status %>
    </dd>
    <dd>
      <% if post_replacement.is_active? %> (current) <% end %>
    </dd>
    <% if post_replacement.status == "approved" %>
      <dt class="replacement-spaced-row">Approver</dt>
      <dd><%= link_to_user post_replacement.approver %></dd>
    <% end %>
  </td>
  <td>
    <dt>Version Uploader</dt>
    <dd><%= link_to_user post_replacement.creator %></dd>

    <% unless post_replacement.status == "original" || post_replacement.status == "pending" %>
      <dt class="replacement-spaced-row">Previous Uploader</dt>
      <dd>
        <%= link_to_user post_replacement.uploader_on_approve %>
        <% if CurrentUser.can_approve_posts? %>
          | penalized: <span class="penalized-status"><%= post_replacement.penalize_uploader_on_approve ? "yes" : "no" %></span>
          <%= link_to "toggle", "#toggle", class: "replacement-toggle-penalize-action", data: { replacement_id: post_replacement.id } %><br>
        <% end %>
      </dd>
    <% end %>

    <dt class="replacement-spaced-row">Sources</dt>
    <dd>
      <% if post_replacement.source.present? %>
        <ul>
          <% post_replacement.source_list.each do |source| %>
            <li><%= external_link_to source, truncate: 46 %></li>
          <% end %>
        </ul>
      <% else %>
        <em>None provided</em>
      <% end %>
    </dd>
  </td>
  <td>
    <dt>Image Info</dt>
    <dd class="replacement-compact-row">
      <%= svg_icon(:circle_check_small, title: "This is the current version", height: 15, width: 15) if post_replacement.is_active? %>
      Replacement:
      <%= post_replacement.image_width %>x<%= post_replacement.image_height %> <%= post_replacement.file_ext %>
      (<%= post_replacement.file_size.to_fs(:human_size, precision: 5) %><% if post_replacement.is_video? %>, 
      <%= post_replacement.post.duration %>s<% end -%>) </dd>
    <dd class="replacement-compact-row">
      Current:
      <%= post_replacement.post.image_width %>x<%= post_replacement.post.image_height %> <%= post_replacement.post.file_ext %>
      (<%= post_replacement.post.file_size.to_fs(:human_size, precision: 5) %><% if post_replacement.post.is_video? %>, 
      <%= post_replacement.post.duration %>s<% end -%>)
    </dd>
    <dt class="replacement-spaced-row">File Info</dt>
    <dd class="replacement-compact-row">File Name: <%= truncate post_replacement.file_name, length: 64 %></dd>
    <dd class="replacement-compact-row">ID: <%= truncate post_replacement.storage_id, length: 64 %></dd>
    <% if post_replacement.md5.present? %>
      <dd class="replacement-compact-row">MD5: <%= post_replacement.md5 %></dd> 
    <% end %>
  </td>
  <td>
    <dt>Created at</dt>
    <dd class="replacement-compact-row"><%= compact_time post_replacement.created_at %></dd>
    <dt>Updated at</dt>
    <dd class="replacement-compact-row"><%= compact_time post_replacement.updated_at %></dd>
    <dt class="replacement-spaced-row">Reason</dt>
    <dd class="replacement-reason"><%= post_replacement.reason.presence || "None provided" %></dd>
  </td>
  <td>
    <% if CurrentUser.can_approve_posts? %>
      <div class="pending-links">
        <% if post_replacement.status == "pending" %>
          <%= link_to "Approve", "#approve", class: "replacement-approve-action", data: { replacement_id: post_replacement.id, penalize: post_replacement.post.uploader != post_replacement.creator } %><br><br>
          <%= link_to "Reject", "#reject", class: "replacement-reject-action", data: { replacement_id: post_replacement.id } %><br>
          <%= link_to "As New Post", "#promote", class: "replacement-promote-action", data: { replacement_id: post_replacement.id } %><br>
        <% end %>
      </div>
      <% if post_replacement.status == "original" %>
        <%= link_to "Reset To", "#reset-to", class: "replacement-approve-action", data: { replacement_id: post_replacement.id, penalize: false } %><br>
      <% end %>
    <% end %>
    <% if CurrentUser.is_admin? %>
      <%= link_to "Destroy", "#destroy", class: "replacement-destroy-action", data: { replacement_id: post_replacement.id } %>
    <% end %>
  </td>
</tr>
